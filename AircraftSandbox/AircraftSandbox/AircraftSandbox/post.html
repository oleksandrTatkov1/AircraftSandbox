<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–¢—Ä–µ–¥ –ø–æ—Å—Ç—É</title>
  <link rel="stylesheet" href="../AircraftSandbox/css/style.css"/>
  <link rel="stylesheet" href="css/post.css"/>
</head>
<body>
  <div class="page-wrapper">
    <header class="header">
      <!-- ... (—Ç–≤—ñ–π —Ö–µ–¥–µ—Ä –±–µ–∑ –∑–º—ñ–Ω) ... -->
    </header>

    <main class="main container">
      <section class="post-thread">
        <div class="post-thread__post">
          <h2 class="post-thread__title" id="post-title"></h2>
          <img src="" alt="Post image" class="post-thread__image" id="post-image" style="display:none;">
          <p class="post-thread__text" id="post-text"></p>
          <div class="post-thread__actions">
          <button class="post-thread__like" data-action="like" data-id="">üëç <span class="like-count" id="like-count">0</span></button>
          <button class="post-thread__dislike" data-action="dislike" data-id="">üëé <span class="dislike-count" id="dislike-count">0</span></button>
          </div>
        </div>

        <div class="post-thread__comments">
          <h3 class="post-thread__comments-title">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h3>
          <div id="comments-container">
            <div id="comment-form" style="margin-top: 20px;">
            <textarea id="comment-text" placeholder="–ù–∞–ø–∏—à—ñ—Ç—å —Å–≤—ñ–π –∫–æ–º–µ–Ω—Ç–∞—Ä..." style="width:100%;padding:10px;border-radius:8px;"></textarea>
            <button id="submit-comment" style="margin-top:10px;padding:8px 16px;">–ù–∞–¥—ñ—Å–ª–∞—Ç–∏</button>
          </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <!-- ... (—Ç–≤–æ–π —Ñ—É—Ç–µ—Ä –±–µ–∑ –∑–º—ñ–Ω) ... -->
    </footer>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="../AircraftSandbox/js/script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const params = new URLSearchParams(location.search);
      const postId = params.get('post');
      const container = document.querySelector('.post-thread__post');
      if (!postId || !container) {
        container?.insertAdjacentHTML('beforeend', '<p>–ü–æ—Å—Ç –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ.</p>');
        return;
      }
      fetch(`/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/getPostHtml.php?post=${postId}`)
        .then(r => r.ok ? r.text() : Promise.reject(r.status))
        .then(html => {
          container.innerHTML = html;
          // –∑–¥–µ—Å—å –º–æ–∂–Ω–æ –≤–µ—à–∞—Ç—å –ª–∞–π–∫–∏/–¥–∏–∑–ª–∞–π–∫–∏, –∞–≤–∞—Ç–∞—Ä–∫–∏ –∏ —Ç.–¥.
        })
        .catch(err => {
          container.innerHTML = `<p>–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –ø–æ—Å—Ç: ${err}</p>`;
        });
    });
  </script>

</body>
<script>
document.addEventListener('DOMContentLoaded', () => {
    fetch('/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/authCheck.php')
        .then(response => response.json())
        .then(data => {
            if (!data.authorized) {
                window.location.href = '/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/registerAlpha/register.html';
            }
        })
        .catch(error => {
            console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó:', error);
            // –º–æ–∂–Ω–æ –≤—Ä–µ–º–µ–Ω–Ω–æ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–∏—Ç—å –ø—Ä–∏ –æ—à–∏–±–∫–µ —Å–µ—Ä–≤–µ—Ä–∞
            window.location.href = '/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/registerAlpha/register.html';
        });
});
</script>
<script>
(function(){
  // –í–µ—à–∞–µ–º –µ–¥–∏–Ω—ã–π —Å–ª—É—à–∞—Ç–µ–ª—å –Ω–∞ –≤—Å—ë —Ç–µ–ª–æ ‚Äî –±–µ–∑ DOMContentLoaded –∏ getElementById
  document.body.addEventListener('click', function(e) {
    // –æ—Ç–ª–∞–≤–ª–∏–≤–∞–µ–º –∫–ª–∏–∫ –ø–æ –∫–Ω–æ–ø–∫–µ ¬´–ù–∞–¥—ñ—Å–ª–∞—Ç–∏¬ª
    const btn = e.target.closest('#submit-comment');
    if (!btn) return;

    e.preventDefault();

    // –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ —á–µ—Ä–µ–∑ querySelector
    const textarea = document.querySelector('#comment-text');
    if (!textarea) return alert('–ü–æ–ª–µ –¥–ª—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');

    const text = textarea.value.trim();
    if (!text) return alert('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—è');

    // –ë–µ—Ä—ë–º ID –ø–æ—Å—Ç–∞ –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ URL
    const postId = new URLSearchParams(window.location.search).get('post');
    if (!postId) return alert('ID –ø–æ—Å—Ç–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ');

    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
    fetch('/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/addComment.php', {
      method: 'POST',
      headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },
      body: new URLSearchParams({ postId, comment: text }).toString()
    })
    .then(res => res.text().then(body => {
      if (!res.ok) throw new Error(body || `HTTP ${res.status}`);
      try {
        return JSON.parse(body);
      } catch {
        throw new Error('Invalid JSON: ' + body);
      }
    }))
    .then(data => {
      if (!data.success) throw new Error(data.message);
      textarea.value = '';
      // –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏
      if (typeof loadComments === 'function') {
        loadComments(postId);
      }
    })
    .catch(err => {
      console.error('addComment error:', err);
      alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –¥–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä:\n' + err.message);
    });
  });
})();
</script>
<script>
  /**
   * –ó–∞–≥—Ä—É–∂–∞–µ—Ç HTML-–∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ø–æ—Å—Ç–∞ –∏ —Ä–µ–Ω–¥–µ—Ä–∏—Ç –∏—Ö –≤ –±–ª–æ–∫–µ #comments-container,
   * —Å–æ—Ö—Ä–∞–Ω—è—è —Ñ–æ—Ä–º—É –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤–Ω–∏–∑—É.
   *
   * @param {string} postId ‚Äî –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ø–æ—Å—Ç–∞
   */
  function loadComments(postId) {
    const container = document.getElementById('comments-container');
    if (!container) return;

    // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â—É—é —Ñ–æ—Ä–º—É (—á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç–∏—Ä–∞—Ç—å –µ—ë)
    const form = document.getElementById('comment-form');
    // –í—ã–ø–æ–ª–Ω—è–µ–º –∑–∞–ø—Ä–æ—Å –∫ –≤–∞—à–µ–º—É PHP-—Å–∫—Ä–∏–ø—Ç—É, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π UL-—Å–ø–∏—Å–æ–∫ <li>‚Ä¶
    fetch(`/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/getCommentsHtml.php?post=${encodeURIComponent(postId)}`)
      .then(res => res.ok ? res.text() : Promise.reject(res.status))
      .then(html => {
        // –í—Å—Ç–∞–≤–ª—è–µ–º HTML –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Ñ–æ—Ä–º—É –≤ –∫–æ–Ω–µ—Ü
        container.innerHTML = html;
        container.appendChild(form);
      })
      .catch(err => {
        console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤:', err);
        container.innerHTML = '<p>–ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä—ñ.</p>';
        container.appendChild(form);
      });
  }

  document.addEventListener('DOMContentLoaded', () => {
    const postId = new URLSearchParams(window.location.search).get('post');
    if (!postId) return;

    // –°—Ä–∞–∑—É –≥—Ä—É–∑–∏–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
    loadComments(postId);

    // –ü–æ–¥–º–µ–Ω—è–µ–º addComment-–æ–±—Ä–∞–±–æ—Ç—á–∏–∫, —á—Ç–æ–±—ã –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–≤–æ–Ω–∏—Ç—å loadComments
    document.body.addEventListener('click', function(e) {
      const btn = e.target.closest('#submit-comment');
      if (!btn) return;

      e.preventDefault();
      const textarea = document.querySelector('#comment-text');
      const text = textarea.value.trim();
      if (!text) return alert('–í–≤–µ–¥—ñ—Ç—å —Ç–µ–∫—Å—Ç –∫–æ–º–µ–Ω—Ç–∞—Ä—è');

      fetch('/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/addComment.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8' },
        body: new URLSearchParams({ postId, comment: text }).toString()
      })
      .then(res => res.text().then(body => {
        if (!res.ok) throw new Error(body || `HTTP ${res.status}`);
        return JSON.parse(body);
      }))
      .then(data => {
        if (!data.success) throw new Error(data.message);
        textarea.value = '';
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        loadComments(postId);
      })
      .catch(err => {
        console.error('‚ùå –ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–µ–Ω—Ç–∞—Ä—è:', err);
        alert('–ù–µ –≤–¥–∞–ª–æ—Å—è –¥–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä:\n' + err.message);
      });
    });
  });
</script>

</html>