
<!DOCTYPE html>
<html lang="uk">
  
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Адмін Панель</title>
  <link rel="stylesheet" href="../AircraftSandbox/css/style.css">
  <link rel="stylesheet" href="../AircraftSandbox/css/styleAPK.css">
  <link rel="stylesheet" href="../AircraftSandbox/css/adminPanelStyle.css">
</head>
<body>
  <div class="page-wrapper">
    <header class="header">
        <div class="container header__container">
            <div class="header__logo">
                <img src="../AircraftSandbox/img/index/header/logo_black.png" alt="logo" class="header__imgL">
            </div>
            <div class="header__menu">
                <nav class="header__nav nav">
                  <ul class="nav__list">
                    <li class="nav__item"><a href="index.html" class="nav__link">Головна</a></li>
                    <li class="nav__item"><a href="forum.html" class="nav__link">Форум</a></li>
       
                    <li class="nav__item"><a href="apk.html" class="nav__link">Додаткові APK</a></li>
                    <li class="nav__item">
                      <input type="checkbox" id="dropItem" class="dropdown-toggle">
                      <label for="dropItem" class="dropdown-label">Додаткові ресурси <span class="arrow">▼</span></label>
                      <ul class="dropdown-menu">
                        <li class="dropdown-item"><a href="https://t.me/SkyTechDev_bot">Підтримка</a></li>
                        <li class="dropdown-item"><a href="guides.html">Туторіали</a></li>
                      </ul>
                    </li>
                  </ul>
                </nav>
          
                  <a href="/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/profile.html">
                    <img id="header-avatar" src="/AircraftSandbox/img/index/header/free-icon-user-483361.png" alt="Профіль" class="profile-icon" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">
                </a>
                       
            </div>
            <div class="menu-btn">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>

    <main class="main">
      <section class="admin-panel">
        <div class="admin-panel__tabs">
          <button class="admin-panel__tab admin-panel__tab--active" data-target="apk">Додати APK</button>
          <button class="admin-panel__tab" data-target="news">Додати новину</button>
          <button class="admin-panel__tab" data-target="delete-apk">Видалити APK</button>
          <button class="admin-panel__tab" data-target="delete-news">Видалити новину</button>
          <button class="admin-panel__tab" data-target="delete-post">Видалити пост</button>
          <button class="admin-panel__tab" data-target="delete-comment">Видалити коментар</button>
        </div>
        

              <form class="admin-panel__form admin-panel__form--apk is-visible" enctype="multipart/form-data">

                <label class="admin-panel__label">Тип APK:
          <select class="admin-panel__input" name="apkType" required>
            <option value="plane">Літаки</option>
            <option value="skinsPlane">Скіни на літаки</option>
            <option value="ground">Наземний транспорт</option>
            <option value="skinsGround">Скіни на наземний транспорт</option>
            <option value="weather">Погодні умови</option>
            <option value="avatar">Аватари</option>
            <option value="skinsAvatar">Скіни для аватара</option>
            <option value="infra">Інфраструктура</option>
          </select>
        </label>

        <label class="admin-panel__label">Опис:
          <textarea class="admin-panel__input" name="apkDesc" required></textarea>
        </label>

        <label class="admin-panel__label">Зображення APK:
          <input class="admin-panel__input" type="file" name="apkImage" accept="image/*" required>
        </label>

        <label class="admin-panel__label">Автор:
          <input class="admin-panel__input" type="text" name="apkAuthor" required>
        </label>

        <label class="admin-panel__label">Розмір (наприклад: 9.8 MB):
          <input class="admin-panel__input" type="text" name="apkSize" required>
        </label>

        <label class="admin-panel__label">Додав:
          <input class="admin-panel__input" type="text" name="apkAddedBy" required>
        </label>

        <label class="admin-panel__label">Дата:
          <input class="admin-panel__input" type="date" name="apkDate" required>
        </label>

        <label class="admin-panel__label">Завантажень:
          <input class="admin-panel__input" type="number" name="apkDownloads" min="0" required>
        </label>

        <label class="admin-panel__label">Посилання на APK:
          <input class="admin-panel__input" type="url" name="apkLink" required>
        </label>

        <button type="submit" class="admin-panel__submit">Додати APK</button>

      </form>

        <form class="admin-panel__form admin-panel__form--news" enctype="multipart/form-data">
          <label class="admin-panel__label">Зображення новини:
            <input class="admin-panel__input" type="file" name="newsImage" accept="image/*" required>
          </label>
          <label class="admin-panel__label">Опис новини:
            <textarea class="admin-panel__input" name="newsDesc" required></textarea>
          </label>
          <label class="admin-panel__label">Індекс слайдеру:
            <textarea class="admin-panel__input"  type="text" name="newsSliderId" required></textarea>
          </label>
         
          <button type="submit" class="admin-panel__submit">Додати новину</button>
        </form>
       <form class="admin-panel__form admin-panel__form--delete-news">
      <label class="admin-panel__label">Оберіть новину для видалення:
          <select id="deleteNewsDropdown" class="admin-panel__input" required></select>
      </label>
      </form>
        <form class="admin-panel__form admin-panel__form--delete-apk">
      <label class="admin-panel__label">Оберіть картку APK для видалення:
          <select id="deleteApkDropdown" class="admin-panel__input" required></select>
      </label>
    </form>
      <form class="admin-panel__form admin-panel__form--delete-post">
        <label class="admin-panel__label">Оберіть користувача:
          <select id="deletePostUserDropdown" class="admin-panel__input" required>
            <option value="">Оберіть користувача</option>
          </select>
        </label>
      
        <label class="admin-panel__label">Оберіть пост:
          <select id="deletePostDropdown" class="admin-panel__input" required>
            <option value="">Оберіть пост</option>
          </select>
        </label>
      
        <button type="button" id="deletePostButton" class="admin-panel__submit">Видалити пост</button>
      </form>
      
      <form class="admin-panel__form admin-panel__form--delete-comment">
        <label class="admin-panel__label">Оберіть користувача:
          <select id="deleteCommentUserDropdown" class="admin-panel__input" required>
            <option value="">Оберіть коментатора</option>
          </select>
        </label>
      
        <label class="admin-panel__label">Оберіть пост:
          <select id="deleteCommentPostDropdown" class="admin-panel__input" required>
            <option value="">Оберіть пост під яким залишино коментар</option>
          </select>
        </label>
      
        <label class="admin-panel__label">Оберіть коментар:
          <select id="deleteCommentDropdown" class="admin-panel__input" required>
            <option value="">Оберіть коментар</option>
          </select>
        </label>
      
        <button type="button" id="deleteCommentButton" class="admin-panel__submit">Видалити коментар</button>
      </form>
      </section>
    </main>

    <footer class="footer">
        <div class="footer__container">
            <div class="links">
                <a href="https://www.instagram.com/skytechdev/?igsh=MXRyZnI2eW9reWp0dg%3D%3D#" class="links_Instagram">Instagram</a>
                <a href="https://t.me/skytechdev" class="links_Telegram">Telegram</a>
                <a href="https://www.youtube.com/@skytechdev" class="links_YouTube">YouTube</a>
            </div>
        </div>
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="../AircraftSandbox/js/script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
        fetch('/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/authCheck.php')
            .then(response => response.json())
            .then(data => {
                if (!data.authorized) {
                    window.location.href = '/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/registerAlpha/register.html';
                }
            })
            .catch(error => {
                console.error('❌ Помилка перевірки авторизації:', error);
                // можно временно перенаправить при ошибке сервера
                window.location.href = '/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/registerAlpha/register.html';
            });
    });
  </script>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('.admin-panel__tab');
      const forms = document.querySelectorAll('.admin-panel__form');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('admin-panel__tab--active'));
          forms.forEach(f => f.classList.remove('is-visible'));

          tab.classList.add('admin-panel__tab--active');
          const target = tab.dataset.target;
          document.querySelector(`.admin-panel__form--${target}`).classList.add('is-visible');
        });
      });
    });
  </script>
  <script>
    document.querySelector('.admin-panel__form--news').addEventListener('submit', function (e) {
      e.preventDefault();

      const form = this;
      const formData = new FormData(form);

      fetch('/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/addNews.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.text())
      .then(response => alert(response))
      .catch(() => alert('❌ Помилка при з’єднанні з сервером.'));
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dropdown = document.getElementById('deleteNewsDropdown');

      // 1) Завантажуємо всі новини і заповнюємо <select>
      fetch('PHP/scripts/getNewsList.php')
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
          return res.json();
        })
        .then(data => {
          // Очікуємо масив {id, Description}
          dropdown.innerHTML = '<option value=\"\">Оберіть новину для видалення</option>';
          data.forEach(item => {
            const opt = document.createElement('option');
            opt.value = item.id;
            // Можна робити item.Description.slice(0,10) для обрізки
            opt.textContent = `${item.id}: ${item.Description}`;
            dropdown.appendChild(opt);
          });
        })
        .catch(err => {
          console.error('❌ Помилка завантаження новин:', err);
          alert('Не вдалося завантажити список новин.');
        });

      // 2) При зміні вибору відправляємо запит на deleteNews.php
      dropdown.addEventListener('change', () => {
        const id = dropdown.value;
        if (!id) return;

        if (!confirm(`Видалити новину з ID ${id}?`)) return;

        fetch('PHP/scripts/deleteNews.php', {
          method: 'POST',
          headers: {'Content-Type':'application/x-www-form-urlencoded'},
          body: 'id=' + encodeURIComponent(id)
        })
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
          return res.text();
        })
        .then(msg => {
          alert(msg);
          // Видаляємо з <select> видалений option
          const removed = dropdown.querySelector(`option[value="${id}"]`);
          if (removed) removed.remove();
          dropdown.selectedIndex = 0;
        })
        .catch(err => {
          console.error('❌ Помилка видалення новини:', err);
          alert('Не вдалося видалити новину.');
        });
      });
    });
  </script>

  <script>
    document.querySelector('.admin-panel__form--apk').addEventListener('submit', function (e) {
      e.preventDefault();

      const form = this;
      const formData = new FormData(form);

      fetch('PHP/scripts/addApk.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.text())
      .then(response => alert(response))
      .catch(() => alert('❌ Помилка при з’єднанні з сервером.'));
    });
  </script>
  <script>
document.addEventListener('DOMContentLoaded', () => {
  const dropdown = document.getElementById('deleteApkDropdown');

  // Завантаження списку карток
  fetch('PHP/scripts/getApkList.php')
    .then(res => res.json())
    .then(data => {
      dropdown.innerHTML = '<option value="">Оберіть APK</option>';
      data.forEach(apk => {
        const option = document.createElement('option');
        option.value = apk.Id;
        option.textContent = `${apk.Id}: ${apk.Description}`;
        dropdown.appendChild(option);
      });
    });

  dropdown.addEventListener('change', () => {
    const id = dropdown.value;
    const text = dropdown.options[dropdown.selectedIndex].text;

    if (!id || !confirm(`Ви впевнені, що хочете видалити картку ${text}?`)) return;

    fetch('PHP/scripts/deleteApk.php', {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: 'id=' + encodeURIComponent(id)
    })
    .then(res => res.text())
    .then(msg => {
      alert(msg);
      dropdown.querySelector(`option[value="${id}"]`).remove();
      dropdown.selectedIndex = 0;
    });
  });
});
</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
  fetch("/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/login_Firebase.php")
  .then(response => response.json())
    .then(user => {
      if (!user || !user.Login) return;

      // Аватар
      const profileAvatar = document.querySelector(".profile-card__avatar");
if (profileAvatar && user.ImagePath) {
  profileAvatar.src = user.ImagePath;
}

const headerAvatar = document.getElementById("header-avatar");
if (headerAvatar && user.ImagePath) {
  headerAvatar.src = user.ImagePath;
}


      // Ім’я
      const username = document.querySelector(".profile-card__username");
      if (username && user.Name) {
        username.textContent = "@" + user.Name;
      }

      // Біо
      const bio = document.querySelector(".profile-card__bio");
      if (bio && user.Bio) {
        bio.textContent = user.Bio;
      }

      // Хедер: показати аватар замість кнопки
      const authButton = document.getElementById("auth-button");
      const userProfile = document.getElementById("user-profile");
      if (authButton) authButton.style.display = "none";
      if (userProfile) userProfile.style.display = "block";

      // Оновити аватар та ім’я у постах
      document.querySelectorAll(".post__user").forEach(el => {
        el.textContent = "@" + user.Name;
      });

      document.querySelectorAll(".post__avatar").forEach(el => {
        el.src = user.ImagePath;
      });
    })
});

    </script>
    <script>
      document.addEventListener("DOMContentLoaded", () => {
        fetch("/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/checkSuperUser.php")
          .then(res => res.json())
          .then(data => {
            if (!data.authorized) {
              window.location.replace("/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/index.html");
            }
          })
          .catch(() => {
            window.location.replace("/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/index.html");
          });
      });
      </script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const userDropdown = document.getElementById('deletePostUserDropdown');
    const postDropdown = document.getElementById('deletePostDropdown');
    const deleteButton = document.getElementById('deletePostButton');
  
    // Завантаження користувачів
    fetch('PHP/scripts/getUsersList.php')
      .then(res => res.json())
      .then(users => {
        userDropdown.innerHTML = '<option value="">Оберіть користувача</option>';
        users.forEach(user => {
          const opt = document.createElement('option');
          opt.value = user.Login;
          opt.textContent = user.Name;
          userDropdown.appendChild(opt);
        });
      })
      .catch(err => {
        console.error('❌ Помилка завантаження користувачів:', err);
        alert('Не вдалося завантажити список користувачів.');
      });
  
    // Завантаження постів після вибору користувача
    userDropdown.addEventListener('change', () => {
      const login = userDropdown.value;
      postDropdown.innerHTML = '<option value="">Оберіть пост</option>';
      if (!login) return;
  
      fetch(`PHP/scripts/getUserPosts.php?login=${encodeURIComponent(login)}`)
        .then(res => res.json())
        .then(posts => {
          posts.forEach(post => {
            const opt = document.createElement('option');
            opt.value = post.id;
            opt.textContent = post.title;
            postDropdown.appendChild(opt);
          });
        })
        .catch(err => {
          console.error('❌ Помилка завантаження постів:', err);
          alert('Не вдалося завантажити список постів.');
        });
    });
  
    // Видалення поста та коментарів
    deleteButton.addEventListener('click', () => {
      const login = userDropdown.value;
      const postId = postDropdown.value;
  
      if (!login || !postId) {
        alert('Будь ласка, оберіть користувача та пост.');
        return;
      }
  
      if (!confirm(`Ви впевнені, що хочете видалити пост ${postId} користувача ${login} разом із коментарями?`)) return;
  
      fetch('PHP/scripts/deleteUserPost.php', {
        method: 'POST',
        headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
        body: `login=${encodeURIComponent(login)}&postId=${encodeURIComponent(postId)}`
      })
        .then(res => {
          if (!res.ok) {
            throw new Error(`HTTP ${res.status} ${res.statusText}`);
          }
          return res.text();
        })
        .then(msg => {
          alert(msg);
          const optionToRemove = postDropdown.querySelector(`option[value="${postId}"]`);
          if (optionToRemove) optionToRemove.remove();
          postDropdown.selectedIndex = 0;
        })
        .catch(err => {
          console.error('❌ Помилка видалення поста та коментарів:', err);
          alert('Не вдалося видалити пост та коментарі.');
        });
    });
  });
  </script>
  
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const userDropdown = document.getElementById('deleteCommentUserDropdown');
      const postDropdown = document.getElementById('deleteCommentPostDropdown');
      const commentDropdown = document.getElementById('deleteCommentDropdown');
      const deleteButton = document.getElementById('deleteCommentButton');
    
      // 1️⃣ Завантаження користувачів
      fetch('PHP/scripts/getCommentUsersList.php')
  .then(res => res.json())
  .then(users => {
    userDropdown.innerHTML = '<option value="">Оберіть коментатора</option>';
    users.forEach(user => {
      const opt = document.createElement('option');
      opt.value = user.Login;
      opt.textContent = user.Name ? `${user.Name} (${user.Login})` : user.Login;
      userDropdown.appendChild(opt);
    });
  })
  .catch(err => {
    console.error('❌ Помилка завантаження користувачів:', err);
    alert('Не вдалося завантажити список користувачів.');
  });

    
      // 2️⃣ Завантаження постів користувача
      userDropdown.addEventListener('change', () => {
        const login = userDropdown.value;
        postDropdown.innerHTML = '<option value="">Оберіть пост</option>';
        commentDropdown.innerHTML = '<option value="">Оберіть коментар</option>';
        if (!login) return;
    
        fetch(`PHP/scripts/getUserCommentPosts.php?login=${encodeURIComponent(login)}`)
  .then(res => res.json())
  .then(posts => {
    postDropdown.innerHTML = '<option value="">Оберіть пост під яким залишино коментар</option>';
    posts.forEach(post => {
      const opt = document.createElement('option');
      opt.value = post.PostId;
      opt.textContent = post.Title ? `${post.Title} (ID: ${post.PostId})` : `ID: ${post.PostId}`;
      postDropdown.appendChild(opt);
    });
  })
  .catch(err => {
    console.error('❌ Помилка завантаження постів:', err);
    alert('Не вдалося завантажити список постів.');
  });

      });
    
      // 3️⃣ Завантаження коментарів
      postDropdown.addEventListener('change', () => {
        const login = userDropdown.value;
        const postId = postDropdown.value;
        commentDropdown.innerHTML = '<option value="">Оберіть коментар</option>';
        if (!login || !postId) return;
    
        fetch(`PHP/scripts/getUserComments.php?login=${encodeURIComponent(login)}&postId=${encodeURIComponent(postId)}`)
          .then(res => {
            if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
            return res.json();
          })
          .then(comments => {
            if (comments.length === 0) {
              const opt = document.createElement('option');
              opt.value = '';
              opt.textContent = 'Коментарів немає';
              commentDropdown.appendChild(opt);
              return;
            }
            comments.forEach(comment => {
              const opt = document.createElement('option');
              opt.value = comment.id;
              opt.textContent = `${comment.text.slice(0, 30)}...`;
              commentDropdown.appendChild(opt);
            });
          })
          .catch(err => {
            console.error('❌ Помилка завантаження коментарів:', err);
            alert('Не вдалося завантажити список коментарів.');
          });
      });
    
      // 4️⃣ Видалення коментаря
      deleteButton.addEventListener('click', () => {
        const login = userDropdown.value;
        const postId = postDropdown.value;
        const commentId = commentDropdown.value;
    
        if (!login || !postId || !commentId) {
          alert('Будь ласка, оберіть користувача, пост та коментар.');
          return;
        }
    
        if (!confirm(`Ви впевнені, що хочете видалити коментар ${commentId}?`)) return;
    
        fetch('PHP/scripts/deleteUserComment.php', {
          method: 'POST',
          headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
          body: `login=${encodeURIComponent(login)}&postId=${encodeURIComponent(postId)}&commentId=${encodeURIComponent(commentId)}`
        })
          .then(res => {
            if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
            return res.text();
          })
          .then(msg => {
            alert(msg);
            const optionToRemove = commentDropdown.querySelector(`option[value="${commentId}"]`);
            if (optionToRemove) optionToRemove.remove();
            commentDropdown.selectedIndex = 0;
          })
          .catch(err => {
            console.error('❌ Помилка видалення коментаря:', err);
            alert('Не вдалося видалити коментар.');
          });
      });
    });
    </script>
    
    
    
</body>
</html>
