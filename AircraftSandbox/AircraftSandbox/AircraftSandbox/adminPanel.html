<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Адмін Панель</title>
  <link rel="stylesheet" href="../AircraftSandbox/css/style.css">
  <link rel="stylesheet" href="../AircraftSandbox/css/styleAPK.css">
  <link rel="stylesheet" href="../AircraftSandbox/css/adminPanelStyle.css">
</head>
<body>
  <div class="page-wrapper">
    <header class="header">
        <div class="container header__container">
            <div class="header__logo">
                <img src="../AircraftSandbox/img/index/header/logo_black.png" alt="logo" class="header__imgL">
            </div>
            <div class="header__menu">
                <nav class="header__nav nav">
                  <ul class="nav__list">
                    <li class="nav__item"><a href="index.html" class="nav__link">Головна</a></li>
                    <li class="nav__item"><a href="forum.html" class="nav__link">Форум</a></li>
                    <li class="nav__item"><a href="routes.html" class="nav__link">Маршрути польотів</a></li>
                    <li class="nav__item"><a href="apk.html" class="nav__link">Додаткові APK</a></li>
                    <li class="nav__item">
                      <input type="checkbox" id="dropItem" class="dropdown-toggle">
                      <label for="dropItem" class="dropdown-label">Додаткові ресурси <span class="arrow">▼</span></label>
                      <ul class="dropdown-menu">
                        <li class="dropdown-item"><a href="https://t.me/SkyTechDev_bot">Підтримка</a></li>
                        <li class="dropdown-item"><a href="guides.html">Туторіали</a></li>
                      </ul>
                    </li>
                  </ul>
                </nav>
                <div class="header__registration">
                  <button class="header__buttonForReg" id="auth-button">
                    Авторизація 
                  </button>
                  <div class="header__profile" id="user-profile" style="display: none;">
                    <img src="/AircraftSandbox/img/index/header/free-icon-user-483361.png" alt="Профіль" class="profile-icon">
                  </div>
                </div>                    
            </div>
            <div class="menu-btn">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>

    <main class="main">
      <section class="admin-panel">
        <div class="admin-panel__tabs">
          <button class="admin-panel__tab admin-panel__tab--active" data-target="apk">Додати APK</button>
          <button class="admin-panel__tab" data-target="news">Додати новину</button>
          <button class="admin-panel__tab" data-target="delete-apk">Видалити APK</button>
          <button class="admin-panel__tab" data-target="delete-news">Видалити новину</button>
        </div>

              <form class="admin-panel__form admin-panel__form--apk is-visible" enctype="multipart/form-data">

                <label class="admin-panel__label">Тип APK:
          <select class="admin-panel__input" name="apkType" required>
            <option value="plane">Літаки</option>
            <option value="skinsPlane">Скіни на літаки</option>
            <option value="ground">Наземний транспорт</option>
            <option value="skinsGround">Скіни на наземний транспорт</option>
            <option value="weather">Погодні умови</option>
            <option value="avatar">Аватари</option>
            <option value="skinsAvatar">Скіни для аватара</option>
            <option value="infra">Інфраструктура</option>
          </select>
        </label>

        <label class="admin-panel__label">Опис:
          <textarea class="admin-panel__input" name="apkDesc" required></textarea>
        </label>

        <label class="admin-panel__label">Зображення APK:
          <input class="admin-panel__input" type="file" name="apkImage" accept="image/*" required>
        </label>

        <label class="admin-panel__label">Автор:
          <input class="admin-panel__input" type="text" name="apkAuthor" required>
        </label>

        <label class="admin-panel__label">Розмір (наприклад: 9.8 MB):
          <input class="admin-panel__input" type="text" name="apkSize" required>
        </label>

        <label class="admin-panel__label">Додав:
          <input class="admin-panel__input" type="text" name="apkAddedBy" required>
        </label>

        <label class="admin-panel__label">Дата:
          <input class="admin-panel__input" type="date" name="apkDate" required>
        </label>

        <label class="admin-panel__label">Завантажень:
          <input class="admin-panel__input" type="number" name="apkDownloads" min="0" required>
        </label>

        <label class="admin-panel__label">Посилання на APK:
          <input class="admin-panel__input" type="url" name="apkLink" required>
        </label>

        <button type="submit" class="admin-panel__submit">Додати APK</button>

      </form>

        <form class="admin-panel__form admin-panel__form--news" enctype="multipart/form-data">
          <label class="admin-panel__label">Зображення новини:
            <input class="admin-panel__input" type="file" name="newsImage" accept="image/*" required>
          </label>
          <label class="admin-panel__label">Опис новини:
            <textarea class="admin-panel__input" name="newsDesc" required></textarea>
          </label>
          <label class="admin-panel__label">Індекс слайдеру:
            <textarea class="admin-panel__input"  type="text" name="newsSliderId" required></textarea>
          </label>
         
          <button type="submit" class="admin-panel__submit">Додати новину</button>
        </form>
       <form class="admin-panel__form admin-panel__form--delete-news">
      <label class="admin-panel__label">Оберіть новину для видалення:
          <select id="deleteNewsDropdown" class="admin-panel__input" required></select>
      </label>
      </form>
        <form class="admin-panel__form admin-panel__form--delete-apk">
      <label class="admin-panel__label">Оберіть картку APK для видалення:
          <select id="deleteApkDropdown" class="admin-panel__input" required></select>
      </label>
    </form>
      </section>
    </main>

    <footer class="footer">
        <div class="footer__container">
            <div class="links">
                <a href="https://www.instagram.com/skytechdev/?igsh=MXRyZnI2eW9reWp0dg%3D%3D#" class="links_Instagram">Instagram</a>
                <a href="https://t.me/skytechdev" class="links_Telegram">Telegram</a>
                <a href="https://www.youtube.com/@skytechdev" class="links_YouTube">YouTube</a>
            </div>
        </div>
    </footer>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
  <script src="../AircraftSandbox/js/script.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const tabs = document.querySelectorAll('.admin-panel__tab');
      const forms = document.querySelectorAll('.admin-panel__form');

      tabs.forEach(tab => {
        tab.addEventListener('click', () => {
          tabs.forEach(t => t.classList.remove('admin-panel__tab--active'));
          forms.forEach(f => f.classList.remove('is-visible'));

          tab.classList.add('admin-panel__tab--active');
          const target = tab.dataset.target;
          document.querySelector(`.admin-panel__form--${target}`).classList.add('is-visible');
        });
      });
    });
  </script>
  <script>
    document.querySelector('.admin-panel__form--news').addEventListener('submit', function (e) {
      e.preventDefault();

      const form = this;
      const formData = new FormData(form);

      fetch('/AircraftSandbox/AircraftSandbox/AircraftSandbox/AircraftSandbox/PHP/scripts/addNews.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.text())
      .then(response => alert(response))
      .catch(() => alert('❌ Помилка при з’єднанні з сервером.'));
    });
  </script>
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const dropdown = document.getElementById('deleteNewsDropdown');

      // 1) Завантажуємо всі новини і заповнюємо <select>
      fetch('PHP/scripts/getNewsList.php')
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
          return res.json();
        })
        .then(data => {
          // Очікуємо масив {id, Description}
          dropdown.innerHTML = '<option value=\"\">Оберіть новину для видалення</option>';
          data.forEach(item => {
            const opt = document.createElement('option');
            opt.value = item.id;
            // Можна робити item.Description.slice(0,10) для обрізки
            opt.textContent = `${item.id}: ${item.Description}`;
            dropdown.appendChild(opt);
          });
        })
        .catch(err => {
          console.error('❌ Помилка завантаження новин:', err);
          alert('Не вдалося завантажити список новин.');
        });

      // 2) При зміні вибору відправляємо запит на deleteNews.php
      dropdown.addEventListener('change', () => {
        const id = dropdown.value;
        if (!id) return;

        if (!confirm(`Видалити новину з ID ${id}?`)) return;

        fetch('PHP/scripts/deleteNews.php', {
          method: 'POST',
          headers: {'Content-Type':'application/x-www-form-urlencoded'},
          body: 'id=' + encodeURIComponent(id)
        })
        .then(res => {
          if (!res.ok) throw new Error(`HTTP ${res.status} ${res.statusText}`);
          return res.text();
        })
        .then(msg => {
          alert(msg);
          // Видаляємо з <select> видалений option
          const removed = dropdown.querySelector(`option[value="${id}"]`);
          if (removed) removed.remove();
          dropdown.selectedIndex = 0;
        })
        .catch(err => {
          console.error('❌ Помилка видалення новини:', err);
          alert('Не вдалося видалити новину.');
        });
      });
    });
  </script>

  <script>
    document.querySelector('.admin-panel__form--apk').addEventListener('submit', function (e) {
      e.preventDefault();

      const form = this;
      const formData = new FormData(form);

      fetch('PHP/scripts/addApk.php', {
        method: 'POST',
        body: formData
      })
      .then(res => res.text())
      .then(response => alert(response))
      .catch(() => alert('❌ Помилка при з’єднанні з сервером.'));
    });
  </script>
  <script>
document.addEventListener('DOMContentLoaded', () => {
  const dropdown = document.getElementById('deleteApkDropdown');

  // Завантаження списку карток
  fetch('PHP/scripts/getApkList.php')
    .then(res => res.json())
    .then(data => {
      dropdown.innerHTML = '<option value="">Оберіть APK</option>';
      data.forEach(apk => {
        const option = document.createElement('option');
        option.value = apk.Id;
        option.textContent = `${apk.Id}: ${apk.Description}`;
        dropdown.appendChild(option);
      });
    });

  dropdown.addEventListener('change', () => {
    const id = dropdown.value;
    const text = dropdown.options[dropdown.selectedIndex].text;

    if (!id || !confirm(`Ви впевнені, що хочете видалити картку ${text}?`)) return;

    fetch('PHP/scripts/deleteApk.php', {
      method: 'POST',
      headers: {'Content-Type': 'application/x-www-form-urlencoded'},
      body: 'id=' + encodeURIComponent(id)
    })
    .then(res => res.text())
    .then(msg => {
      alert(msg);
      dropdown.querySelector(`option[value="${id}"]`).remove();
      dropdown.selectedIndex = 0;
    });
  });
});
</script>
</body>
</html>
